<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Eject All Disks</title>
		<link rel="stylesheet" href="../libs/css/sdpi.css" />
	</head>
	<body>
		<div class="sdpi-wrapper">
			<div class="sdpi-item">
				<div class="sdpi-item-label">Display</div>
				<div class="sdpi-item-value">
					<div class="sdpi-item-child">
						<input id="showTitle" type="checkbox" checked />
						<label for="showTitle" class="sdpi-item-label"><span></span>Show disk count on button</label>
					</div>
				</div>
			</div>
		</div>

		<script src="../libs/js/property-inspector.js"></script>
		<script>
			function connectElgatoStreamDeckSocket(inPort, inPluginUUID, inRegisterEvent, inInfo, inActionInfo) {
				const uuid = inPluginUUID;
				const websocket = new WebSocket("ws://127.0.0.1:" + inPort);

				websocket.onopen = function () {
					// Register with Stream Deck
					websocket.send(JSON.stringify({
						event: inRegisterEvent,
						uuid: uuid
					}));
					// Request current settings
					websocket.send(JSON.stringify({
						event: "getSettings",
						context: uuid
					}));
				};

				websocket.onmessage = function (evt) {
					const data = JSON.parse(evt.data);
					if (data.event === "didReceiveSettings") {
						const settings = data.payload.settings;
						if (settings.showTitle !== undefined) {
							document.getElementById("showTitle").checked = settings.showTitle;
						}
					}
				};

				// Save settings when checkbox changes
				document.getElementById("showTitle").addEventListener("change", function () {
					websocket.send(JSON.stringify({
						event: "setSettings",
						context: uuid,
						payload: {
							showTitle: this.checked
						}
					}));
				});
			}
		</script>
	</body>
</html>
